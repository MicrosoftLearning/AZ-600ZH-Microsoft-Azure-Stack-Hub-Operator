---
lab:
    title: '实验室：配置和管理 Azure Stack Hub 存储帐户'
    module: '模块 5：管理基础结构'
---

# 实验室 - 配置和管理 Azure Stack Hub 存储帐户
# 学生实验室手册

## 实验室依赖项

- 无

## 预计用时

30 分钟

## 实验室场景

你是 Azure Stack Hub 环境的操作员。你需要配置和管理其存储帐户。

## 目标

完成本实验室后，你将能够：

- 配置 Azure Stack Hub 存储
- 管理 Azure Stack Hub 存储帐户

## 实验室环境 

实验室环境由以下部分组成：

- 在具有以下接入点的 **AzS-HOST1** 服务器上运行的 ASDK 部署：

  - 管理员门户：https://adminportal.local.azurestack.external
  - 管理员 ARM 终结点：https://adminmanagement.local.azurestack.external
  - 用户门户：https://portal.local.azurestack.external
  - 用户 ARM 终结点：https://management.local.azurestack.external

- 管理用户：

  - ASDK 云操作员用户名： **CloudAdmin@azurestack.local**
  - ASDK 云操作员密码： **Pa55w.rd1234**
  - ASDK 主机管理员用户名： **AzureStackAdmin@azurestack.local**
  - ASDK 主机管理员密码： **Pa55w.rd1234**

你将在本实验室过程中创建其他用户帐户。


### 练习 0：实验室准备

在本练习中，你将创建将在本实验室中使用的 Active Directory 用户帐户：

1. 创建租户用户帐户（以云操作员的身份）

#### 任务 1：创建租户用户帐户（以云操作员的身份）

在此任务中，你将：

- 创建租户用户帐户（以云操作员的身份）

1. 如果需要，请使用以下凭据登录到 **AzS-HOST1**：

    - 用户名： **AzureStackAdmin@azurestack.local**
    - 密码： **Pa55w.rd1234**

1. 在与 **AzS-HOST1** 的远程桌面会话中，单击 **“开始”**，在 **“开始”** 菜单中，单击 **“Windows 管理工具”**，然后在管理工具列表中，双击 **“Active Directory 管理中心”**。
1. 在 **“Active Directory 管理中心”** 控制台中，单击 **“azurestack(本地)”**。
1. 在“详细信息”窗格中，双击 **“用户”** 容器。
1. 在 **“任务”** 窗格的 **“用户”** 部分中，单击 **“新建” -> “用户”**。
1. 在 **“创建用户”** 窗口中，指定以下设置，然后单击 **“确定”**： 

    - 全名：**T1U1**
    - 用户 UPN 登录名： **t1u1@azurestack.local**
    - 用户 SamAccountName： **azurestack\t1u1**
    - 密码： **Pa55w.rd**
    - 密码选项： **“其他密码选项”->“密码永不过期”**

>**回顾**： 完成本练习后，你创建了将在本实验室中使用的 Active Directory 帐户。


### 练习 1：配置 Azure Stack Hub 存储

在本练习中，你将配置 Azure Stack Hub 存储：

1. 配置存储帐户保留
1. 创建包含存储服务的计划
1. 创建基于该计划的套餐

#### 任务 1：配置存储帐户保留

在此任务中，你将：

- 配置存储帐户保留

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示 [Azure Stack Hub 管理员门户](https://adminportal.local.azurestack.external/)的 Web 浏览器窗口，并使用 CloudAdmin@azurestack.local 登录。
1. 在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“所有服务”**。
1. 在 **“所有服务”** 边栏选项卡上，选择 **“管理”** 部分，然后单击 **“区域管理”**。
1. 在 **“本地”** 边栏选项卡上，单击 **“资源提供程序”**。
1. 在 **“资源提供程序”** 边栏选项卡上，单击 **“存储”**。
1. 在 **“存储”** 边栏选项卡上，单击 **“配置”**。
1. 在 **“存储 - 配置”** 边栏选项卡上的 **“已删除的存储帐户的保留期(天)”** 文本框中，键入 10，然后单击 **“保存”**。


#### 任务 2：创建包含存储服务的计划

在此任务中，你将：

- 创建包含存储服务的计划。

1. 在与 **AzS-HOST1** 的远程桌面会话中，在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。 
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**。
1. 在 **“套餐 + 计划”** 边栏选项卡上，单击 **“计划”**。
1. 在 **“新建计划”** 边栏选项卡的 **“基本信息”** 选项卡上，指定以下设置：

    - 显示名称： **storage-plan1**
    - 资源名称： **storage-plan1**
    - 资源组：新资源组名称 **storage-plans-RG**

1. 单击 **“下一步:  服务 >”**。
1. 在 **“新建计划”** 边栏选项卡的 **“服务”** 选项卡上，选中 **“Microsoft.Storage”** 复选框。
1. 单击 **“下一步:  配额>”**。
1. 在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡上，单击 **“Microsoft.Storage”** 下拉列表旁边的 **“新建”**。
1. 在 **“创建存储配额”** 边栏选项卡上，指定以下设置，然后单击 **“确定”**：

    - 名称： **storage-plan1-storage-quota**
    - 容量上限 (GB)： **200**
    - 存储帐户总数： **5**

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。


#### 任务 3：创建基于该计划的套餐

在此任务中，你将：

- 创建基于该计划的套餐。 

1. 在与 **AzS-HOST1** 的远程桌面会话中，在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。 
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**。
1. 在 **“套餐 + 计划”** 边栏选项卡上，单击 **“套餐”**。
1. 在 **“新建套餐”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置：

    - 显示名称： **storage-offer1**
    - 资源名称： **storage-offer1**
    - 资源组： **storage-offers-RG**
    - 公开提供此套餐： **是**

1. 单击 **“下一步: 基本计划 >”**。 
1. 在 **“新建套餐”** 边栏选项卡的 **“基本计划”** 选项卡上，选中 **“storage-plan1”** 条目旁边的复选框。
1. 单击 **“下一步: 附加产品计划 >”**。
1. 保留 **“附加产品计划”** 设置为默认值，单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。

>**回顾**： 完成本练习后，你配置了已删除的存储帐户的保留设置并创建了一个公共套餐，其中包含基于 **Microsoft.Storage** 服务的计划。 


### 练习 2：管理 Azure Stack Hub 存储帐户。

在本练习中，你将管理 Azure Stack Hub 存储帐户：

1. 创建和删除 Azure 存储帐户（以租户用户的身份）
1. 恢复删除的存储帐户（以云操作员的身份）
1. 回收存储容量（以云操作员的身份）

#### 任务 1：创建和删除 Azure 存储帐户（以租户用户的身份）

在此任务中，你将：

- 创建和删除 Azure 存储帐户（以租户用户的身份） 

1. 在与 **AzS-HOST1** 的远程桌面会话中，启动 Web 浏览器的 InPrivate 会话。
1. 在 Web 浏览器窗口中，导航到 [Azure Stack Hub 用户门户](https://portal.local.azurestack.external)，并使用 **t1u1@azurestack.local** 和密码 **Pa55w.rd** 登录。
1. 在 Azure Stack Hub 用户门户中，单击“仪表板”上的 **“获取订阅”** 磁贴。
1. 在 **“获取订阅”** 边栏选项卡的 **“名称”** 文本框中，键入 **“t1u1-storage-subscription1”**。
1. 在套餐列表中，选择 **“storage-offer1”**，然后单击 **“创建”**。
1. 出现消息 **“订阅已创建。 必须刷新门户才能开始使用订阅”** 时，请单击 **“刷新”**。 
1. 在 Azure Stack Hub 租户门户的中心菜单中，单击 **“所有服务”**。
1. 在服务列表中，单击 **“订阅”**。
1. 在 **“订阅”** 边栏选项卡上，单击 **“t1u1-storage-subscription1”**。
1. 在 **“t1u1-base-subscrption1”** 边栏选项卡上，单击 **“资源”**。
1. 在 **“t1u1-base-subscrption1 - 资源”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“数据 + 存储”**，然后单击 **“存储帐户”**。
1. 在 **“创建存储帐户”** 边栏选项卡的 **“基本信息”** 选项卡上，指定以下设置（其他设置则保留为默认值）：

    - 资源组：新资源组名称 **storage-RG**
    - 名称：由 3 - 24 个小写字母或数字组成的唯一名称
    - 位置： **本地**
    - 性能： **标准**
    - 帐户种类： **存储（常规用途 v1）**
    - 复制： **本地冗余存储 (LRS)**

1. 在 **“创建存储帐户”** 边栏选项卡的 **“基本信息”** 选项卡上，单击 **“下一步: 高级 >”**。
1. 在 **“创建存储帐户”** 边栏选项卡的 **“高级”** 选项卡上，保留默认设置，然后单击 **“查看 + 创建”**。
1. 在 **“创建存储帐户”** 边栏选项卡的 **“查看 + 创建”** 选项卡上，单击 **“创建”**。

    >**备注**： 等待存储帐户预配完成。此操作大约需要 1 分钟。

1. 按照步骤 11-16 操作，在同一资源组中创建另一个具有相同设置的存储帐户。 

    >**备注**： 接下来，你将删除这两个存储帐户。请务必先记录它们的名称。稍后将在本实验室用到它们。

1. 在 Azure Stack Hub 用户门户的主菜单中，单击 **“所有服务”**，然后在 **“所有服务”** 边栏选项卡上，单击 **“存储帐户”**。
1. 在 **“存储帐户”** 边栏选项卡上，确保订阅筛选器包括 **“t1u1-storage-subscription1”**，在存储帐户列表中，选择在此任务中先前创建的两个存储帐户，然后单击 **“删除”**。
1. 在 **“删除资源”** 边栏选项卡上的 **“确认删除”** 文本框中，键入 **“是”**，然后单击 **“删除”**。

#### 任务 2：恢复删除的存储帐户（以云操作员的身份） 

在此任务中，你将：

- 恢复删除的存储帐户（以云操作员的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，切换到显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口，单击 **“所有服务”**，在 **“所有服务”** 边栏选项卡上，单击 **“管理”**，然后在管理服务列表中单击 **“存储”**。
1. 在 **“存储”** 边栏选项卡上，单击 **“存储帐户”**。
1. 在 **“存储 \| 存储帐户”** 边栏选项卡上的“帐户名称”筛选器文本框中，键入在上一个任务中创建的第一个存储帐户的名称，然后验证列出的存储帐户名称是否处于 **“已删除”** 状态。
1. 单击表示第一个已删除的存储帐户的条目。
1. 在 **“存储帐户”** 边栏选项卡中，单击 **“恢复”**。出现确认提示时，请单击 **“是”**。

    >**备注**： 等待操作完成。所需时间应该不超过一分钟。请记住，恢复的存储帐户可能要额外花费一些时间才会出现在用户门户中。

1. 关闭 **“存储帐户”** 边栏选项卡。


#### 任务 3：回收存储容量（以云操作员的身份） 

在此任务中，你将：

- 回收存储容量（以云操作员的身份）

1. 在 Azure Stack Hub 管理员门户的与 **AzS-HOST1** 的远程桌面会话中，以 CloudAdmin@azurestack.local 身份登录时，在 **“存储 \| 存储帐户”** 边栏选项卡中，单击 **“刷新”**。
1. 在 **“帐户名称”** 筛选器文本框中，使用第一个存储帐户的名称，验证列出的存储帐户现在是否处于 **“活动”** 状态。
1. 在 **“存储 \| 存储帐户”** 边栏选项卡上的 **“帐户名称”** 筛选器文本框中，键入在上一个任务中创建的第二个存储帐户的名称，然后验证列出的存储帐户名称是否处于 **“已删除”** 状态。
1. 在 **“存储 \| 存储帐户”** 边栏选项卡上，单击 **“回收空间”**，出现确认提示时，单击 **“是”**。

    >**备注**： 等待操作完成。所需时间应该不超过一分钟。

1. 刷新浏览器页面。
1. 回到 **“存储 \| 存储帐户”** 边栏选项卡，在 **“帐户名称”** 筛选器文本框中，键入在上一个任务中创建的第二个存储帐户的名称，然后验证其名称是否不再显示在搜索结果列表中。 

>**回顾**： 在本练习中，你以租户用户的身份创建和删除了存储帐户，并以云操作员的身份恢复了已删除的存储帐户并回收了存储容量。