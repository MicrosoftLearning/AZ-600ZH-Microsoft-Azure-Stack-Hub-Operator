---
lab:
    title: '实验室：在 Azure Stack Hub 中管理套餐和计划'
    module: '模块 2：提供服务'
---

# 实验室 - 在 Azure Stack Hub 中管理套餐和计划
# 学生实验室手册

## 实验室依赖项

- 无

## 预计用时

60 分钟

## 实验室场景

你是 Azure Stack Hub 环境的操作员。你需要为用户实现套餐和计划。你需要确保所有用户都具有相同的基本服务集，但希望仅向某些用户提供对其他服务的访问权限。

## 目标

完成本实验室后，你将能够：

- 使用 Azure Stack Hub 管理员门户实现 Azure Stack Hub 套餐和计划

## 实验室环境 

实验室环境由以下部分组成：

- 在具有以下接入点的 **AzS-HOST1** 服务器上运行的 ASDK 部署：

  - 管理员门户：https://adminportal.local.azurestack.external
  - 管理员 ARM 终结点：https://adminmanagement.local.azurestack.external
  - 用户门户：https://portal.local.azurestack.external
  - 用户 ARM 终结点：https://management.local.azurestack.external

- 管理用户：

  - ASDK 云操作员用户名：**CloudAdmin@azurestack.local**
  - ASDK 云操作员密码：**Pa55w.rd1234**
  - ASDK 主机管理员用户名：**AzureStackAdmin@azurestack.local**
  - ASDK 主机管理员密码：**Pa55w.rd1234**

你将在本实验室过程中创建其他用户帐户。


### 练习 0：实验室准备

在本练习中，你将创建将在本实验室中使用的 Active Directory 用户帐户：

1. 创建用户帐户（以云操作员的身份）


#### 任务 1：创建首个用户帐户（以云操作员的身份）

1. 如果需要，请使用以下凭据登录到 **AzS-HOST1**：

    - 用户名：**AzureStackAdmin@azurestack.local**
    - 密码：**Pa55w.rd1234**

1. 在与 **AzS-HOST1** 的远程桌面会话中，单击 **“开始”**，在 **“开始”** 菜单中，单击 **“Windows 管理工具”**，然后在管理工具列表中，双击 **“Active Directory 管理中心”**。
1. 在 **“Active Directory 管理中心”** 控制台中，单击 **“azurestack(本地)”**。
1. 在“详细信息”窗格中，双击 **“用户”** 容器。
1. 在 **“任务”** 窗格的 **“用户”** 部分中，单击 **“新建” -> “用户”**。
1. 在 **“创建用户”** 窗口中，指定以下设置，然后单击 **“确定”**： 

    - 全名： **T1U1**
    - 用户 UPN 登录名： **t1u1@azurestack.local**
    - 用户 SamAccountName： **azurestack\t1u1**
    - 密码：**Pa55w.rd**
    - 密码选项： **“其他密码选项”->“密码永不过期”**

1. 重复步骤 5-6，使用以下设置创建另一个用户帐户：

    - 全名： **T1U2**
    - 用户 UPN 登录名： **t1u2@azurestack.local**
    - 用户 SamAccountName： **azurestack\t1u2**
    - 密码：**Pa55w.rd**
    - 密码选项： **“其他密码选项”->“密码永不过期”**

> **回顾**： 在本练习中，你创建了将在本实验室中使用的 Active Directory 用户帐户。

### 练习 1：创建套餐（以云操作员的身份）

在本练习中，你将充当云操作员，并创建一个包含计算、存储和网络服务的计划，以及一个包含此计划的套餐。接下来，你将公开此套餐，允许用户基于此套餐创建订阅。 
练习包含以下任务：

1. 创建包含计算、存储和网络服务的计划（以云操作员的身份）。
1. 根据该计划创建公共套餐（以云操作员的身份）
1. 根据该计划创建专用套餐（以云操作员的身份）

#### 任务 1：创建包含计算、存储和网络服务的计划（以云操作员的身份）

在此任务中，你将：

- 创建两个包含计算、存储和网络服务的计划（以云操作员的身份）。

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示 [Azure Stack Hub 管理员门户](https://adminportal.local.azurestack.external/)的 Web 浏览器窗口，并使用 CloudAdmin@azurestack.local 登录。
1. 在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**，然后单击 **“计划”**。
1. 在 **“新建计划”** 边栏选项卡的 **“基本信息”** 选项卡上，指定以下设置：

    - 显示名称： **base-plan1**
    - 资源名称： **base-plan1**
    - 资源组：新资源组名称 **base-plans-RG**

1. 单击 **“下一步: 服务 >”**。
1. 在 **“新建计划”** 边栏选项卡的 **“服务”** 选项卡上，选中 **“Microsoft.Compute”**、 **“Microsoft.Storage”** 和 **“Microsoft.Network”** 复选框。
1. 单击 **“下一步: 配额>”**。
1. 在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡上，指定以下设置

    - Microsoft.Compute： **默认配额**
    - Microsoft.Storage： **默认配额**
    - Microsoft.Network： **默认配额**

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。

1. 在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**，然后单击 **“计划”**。
1. 在 **“新建计划”** 边栏选项卡的 **“基本信息”** 选项卡上，指定以下设置：

    - 显示名称： **base-plan2**
    - 资源名称： **base-plan2**
    - 资源组：新资源组名称  **base-plans-RG**

1. 单击 **“下一步: 服务 >”**。
1. 在 **“新建计划”** 边栏选项卡的 **“服务”** 选项卡上，选中 **“Microsoft.Compute”**、 **“Microsoft.Storage”** 和 **“Microsoft.Network”** 复选框。
1. 单击 **“下一步: 配额>”**。
1. 在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡上，单击 **“Microsoft.Compute”** 下拉列表旁边的 **“新建”**。
1. 在 **“创建计算配额”** 边栏选项卡上，指定以下设置，然后单击 **“确定”**：

    - 名称： **base-plan1-compute-quota**
    - 虚拟机数：**40**
    - 虚拟机核心数： **100**
    - 可用性集数： **20**
    - 虚拟机规模集数：**40**
    - 标准托管磁盘的容量 (GB)： **4096**
    - 高级托管磁盘的容量 (GB)： **4096**

1. 返回到在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡，单击 **“Microsoft.Storage”** 下拉列表旁边的 **“新建”**。
1. 在 **“创建存储配额”** 边栏选项卡上，指定以下设置，然后单击 **“确定”**：

    - 名称： **base-plan1-storage-quota**
    - 容量上限 (GB)：**4096**
    - 存储帐户总数：**40**

1. 返回到在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡，单击 **“Microsoft.Network”** 下拉列表旁边的 **“新建”**。
1. 在 **“创建网络配额”** 边栏选项卡上，指定以下设置，然后单击 **“确定”**：

    - 名称： **base-plan1-network-quota**
    - 虚拟网络数上限：**100**
    - 虚拟网络网关数上限： **2**
    - 网络连接数： **4**
    - 公共 IP 数上限： **100**
    - 最大 NIC 数**200**
    - 负载均衡器数上限： **100**
    - 网络安全组数上限： **100**

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。


#### 任务 2：根据该计划创建公共套餐（以云操作员的身份）

在此任务中，你将：

- 根据该计划创建公共套餐（以云操作员的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。 
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**，然后单击 **“套餐”**。
1. 在 **“新建套餐”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置：

    - 显示名称： **base-offer1**
    - 资源名称： **base-offer1**
    - 资源组： **base-offers-RG**
    - 公开提供此套餐： **是**

1. 单击 **“下一步: 基本计划 >”**。 
1. 在 **“新建套餐”** 边栏选项卡的 **“基本计划”** 选项卡上，选中 **“base-plan1”** 条目旁边的复选框。
1. 单击 **“下一步: 附加产品计划 >”**。
1. 保留 **“附加产品计划”** 设置为默认值，单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。


#### 任务 3：根据该计划创建专用套餐（以云操作员的身份）

在此任务中，你将：

- 根据该计划创建专用套餐（以云操作员的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，在显示 Azure Stack Hub 管理员门户的 Web 浏览器窗口中，单击 **“+ 创建资源”**。 
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**。
1. 在 **“套餐 + 计划”** 边栏选项卡上，单击 **“套餐”**。
1. 在 **“新建套餐”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置：

    - 显示名称： **base-offer2**
    - 资源名称： **base-offer2**
    - 资源组： **base-offers-RG**
    - 公开提供此套餐： **否**

1. 单击 **“下一步: 基本计划 >”**。 
1. 在 **“新建套餐”** 边栏选项卡的 **“基本计划”** 选项卡上，选中 **“base-plan2”** 条目旁边的复选框。
1. 单击 **“下一步: 附加产品计划 >”**。
1. 保留 **“附加产品计划”** 设置为默认值，单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。

>**回顾**： 在本练习中，你创建了一个计划和基于该计划的两个套餐，其中一个是公共套餐，另一个则是专用套餐。


### 练习 2：根据套餐创建订阅（以用户身份）

在本练习中，你将根据在上一练习中创建的两个套餐创建订阅。练习包含以下任务：

1. 注册套餐（以首位用户的身份）
1. 将订阅分配给第二位用户（以操作员的身份）

#### 任务 1：注册套餐（以首位用户的身份）

在此任务中，你将：

- 注册套餐（以首位用户的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，启动 Web 浏览器的 InPrivate 会话。
1. 在 Web 浏览器窗口中，导航到 [Azure Stack Hub 用户门户](https://portal.local.azurestack.external)，并使用 **t1u1@azurestack.local** 和密码 **Pa55w.rd** 登录。
1. 在 Azure Stack Hub 用户门户中，单击“仪表板”上的 **“获取订阅”** 磁贴。
1. 在 **“获取订阅”** 边栏选项卡的 **“名称”** 文本框中，键入 **“t1u1-base-subscription1”**。
1. 在套餐列表中，选择 **“base-offer1”**，然后单击 **“创建”**。
1. 出现消息 **“订阅已创建。 必须刷新门户才能开始使用订阅”** 时，请单击 **“刷新”**。 
1. 在 Azure Stack Hub 租户门户的中心菜单中，单击 **“所有服务”**。
1. 在服务列表中，单击 **“订阅”**。
1. 在 **“订阅”** 边栏选项卡上，单击 **“t1u1-base-subscription1”**。
1. 在 **“t1u1-base-subscrption1”** 边栏选项卡上，单击 **“资源”**。
1. 在 **“t1u1-base-subscrption1 - 资源”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“安全 + 标识”**，然后单击 **“密钥保管库”**。
1. 在 **“创建密钥保管库”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置（其他设置则保留为默认值）：

    - 资源组：新资源组名称 **kv-RG**
    - 密钥保管库名称：由 3 到 24 个字母数字字符和破折号组成的任意唯一名称，以字母开头

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。
1. 验证部署是否失败。 

    >**备注**： 查看错误消息 **“资源命名空间 'Microsoft.KeyVault' 无效”**。无法创建密钥保管库，因为套餐中不包含该密钥保管库。

1. 从 Azure Stack Hub 用户门户注销，然后关闭 Web 浏览器的 InPrivate 会话。

#### 任务 2：将订阅分配给第二位用户（以操作员的身份）

在此任务中，你将：

- 将订阅分配给第二位用户（以操作员的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示你以 CloudAdmin@azurestack.local 身份登录的 [Azure Stack Hub 管理员门户](https://adminportal.local.azurestack.external/)的 Web 浏览器窗口，然后选择 **“所有资源”**。
1. 在 **“所有资源”** 边栏选项卡上，搜索并选择 **“base-offer2”**。
1. 在 **“base-offer2”** 边栏选项卡上，选择 **“订阅”**。
1. 在 **“base-offer2 \| 订阅”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“创建用户订阅”** 边栏选项卡上，指定以下设置，然后单击 **“创建”**。

    - 名称： **t1u2-base-subscription1**
    - 用户： **t1u2@azurestack.local**
    - 目录租户： **ADFS.azurestack.local**
    - 套餐名称： **base-offer2**

1. 在与 **AzS-HOST1** 的远程桌面会话中，启动 Web 浏览器的 InPrivate 会话。
1. 在 Web 浏览器窗口中，导航到 [Azure Stack Hub 用户门户](https://portal.local.azurestack.external)，并使用密码 **Pa55w.rd** 以 **t1u2@azurestack.local** 身份登录。
1. 在 Azure Stack Hub 用户门户的中心菜单中，选择 **“所有服务”**，然后在 **“所有服务”** 边栏选项卡上，选择 **“订阅”**。
1. 在 **“订阅”** 边栏选项卡上，选择 **“t1u2-base-subscription1”**。
1. 在 **“t1u2-base-subscrption1”** 边栏选项卡上，单击 **“资源”**。
1. 在 **“t1u2-base-subscrption1 - 资源”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“安全 + 标识”**，然后单击 **“密钥保管库”**。
1. 在 **“创建密钥保管库”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置（其他设置则保留为默认值）：

    - 资源组：新资源组名称 **kv-RG**
    - 密钥保管库名称：由 3 到 24 个字母数字字符和破折号组成的任意唯一名称，以字母开头

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。
1. 验证部署是否失败。 

    >**备注**： 查看错误消息 **“资源命名空间 'Microsoft.KeyVault' 无效”**。无法创建密钥保管库，因为套餐中不包含该密钥保管库。

1. 从 Azure Stack Hub 用户门户注销，然后关闭 Web 浏览器的 InPrivate 会话。

>**回顾**： 在本练习中，你以两个用户的身份订阅了套餐，并以这种方式创建了两个新用户订阅。


### 练习 3：创建附加产品计划并将其分配给用户订阅（以云操作员的身份）

在本练习中，你将充当云操作员，并创建一个包含密钥保管库服务的附加产品计划。接下来，你会将该计划分配给某个用户订阅。 

1. 创建包含密钥保管库服务的附加产品计划（以云操作员的身份）。
1. 将该附加产品计划分配给现有套餐（以云操作员的身份）

#### 任务 1：创建包含密钥保管库服务的附加产品计划（以云操作员的身份）

在此任务中，你将：

- 创建包含密钥保管库服务的附加产品计划（以云操作员的身份）。

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示以 CloudAdmin@azurestack.local 身份登录的 Azure Stack Hub 管理员门户的 Web 浏览器窗口，然后单击 **“+ 创建资源”**。 
1. 在 **“新建”** 边栏选项卡上，单击 **“套餐 + 计划”**。
1. 在 **“套餐 + 计划”** 边栏选项卡上，单击 **“计划”**。
1. 在 **“新建计划”** 边栏选项卡上，指定以下设置：

    - 显示名称： **add-on-plan2**
    - 资源名称： **add-on-plan2**
    - 资源组：新资源组名称 **add-on-plans-RG**

1. 单击 **“下一步: 服务 >”**。
1. 在 **“新建计划”** 边栏选项卡的 **“服务”** 选项卡上，选中 **“Microsoft.KeyVault”** 复选框。
1. 单击 **“下一步: 配额>”**。
1. 在 **“新建计划”** 边栏选项卡的 **“配额”** 选项卡上，选择 **“Microsoft.KeyVault”** 下拉列表中的 **“无限制”**。
1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

    >**备注**： 等待部署完成。这应该只需要几秒钟时间。


#### 任务 2：将该附加产品计划分配给现有套餐（以云操作员的身份）

在此任务中，你将：

- 将该附加产品计划分配给现有套餐（以云操作员的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示以 CloudAdmin@azurestack.local 身份登录的 Azure Stack Hub 管理员门户的 Web 浏览器窗口，然后单击 **“所有资源”**。 
1. 在资源列表中，搜索并选择 **“base-offer2”**。
1. 在 **“base-offer2”** 边栏选项卡上，选择 **“附加产品计划”**。
1. 在 **“base-offer2 \| 附加产品计划”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“计划”** 边栏选项卡上，单击 **“add-on-plan2”**，然后单击 **“选择”**。 

>**回顾**： 在本练习中，你创建了一个附加产品计划，并将其分配给了与第二个用户的订阅相关联的现有套餐。


### 练习 4：检查附加产品计划的可用性（以第二个用户的身份）

在本练习中，你将充当注册了在第一个练习中创建的套餐并创建了新订阅的用户。练习包含以下任务：

1. 通过添加附加产品计划修改订阅（以第二位用户的身份）
1. 验证附加产品计划的功能（以第二位用户的身份）

#### 任务 1：通过添加附加产品计划修改订阅（以第二位用户的身份）

在此任务中，你将：

- 检查附加产品计划的可用性（以第二个用户的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，启动 Web 浏览器的 InPrivate 会话。
1. 在 Web 浏览器窗口中，导航到 [Azure Stack Hub 用户门户](https://portal.local.azurestack.external)，并使用 **t1u1@azurestack.local** 和密码 **Pa55w.rd** 登录。
1. 在 Azure Stack Hub 用户门户的中心菜单中，单击 **“所有服务”**。
1. 在服务列表中，单击 **“订阅”**。
1. 在 **“订阅”** 边栏选项卡上，单击 **“t1u2-base-subscription1”**。
1. 在 **“t1u2-base-subscription1”** 边栏选项卡上，单击 **“+ 添加计划”**。
1. 在 **“添加计划”** 边栏选项卡上，选择 **“add-on-plan2”**。如果系统发出提示，请刷新显示 Azure Stack 用户门户的 Web 浏览器页面。
1. 返回到 **“t1u2-base-subscription1”** 边栏选项卡，单击 **“附加产品计划”**。
1. 在 **“t1u2-base-subscription2 | 附加产品计划”** 边栏选项卡上，请注意表示 **“add-on-plan2”** 的条目。

#### 任务 2：验证附加产品计划的功能（以第二位用户的身份）

在此任务中，你将：

- 检查附加产品计划的可用性（以第二个用户的身份）

1. 在与 **AzS-HOST1** 的远程桌面会话中，打开显示以 t1u2@azurestack.local 身份登录的 Azure Stack Hub 用户门户的 Web 浏览器的 InPrivate 会话，
1. 在 **“t1u2-base-subscrption1”** 边栏选项卡上，单击 **“资源”**。
1. 在 **“t1u2-base-subscrption1 - 资源”** 边栏选项卡上，单击 **“+ 添加”**。
1. 在 **“新建”** 边栏选项卡上，单击 **“安全 + 标识”**，然后单击 **“密钥保管库”**。
1. 在 **“创建密钥保管库”** 边栏选项卡的 **“基本信息”** 选项卡中，指定以下设置（其他设置则保留为默认值）：

    - 资源组： **kv-RG**
    - 密钥保管库名称：由 3 到 24 个字母数字字符和破折号组成的任意唯一名称，以字母开头

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。
1. 验证部署是否成功。
1. 从 Azure Stack Hub 用户门户注销，然后关闭 Web 浏览器的 InPrivate 会话。

>**回顾**： 在本练习中，你验证了附加产品计划的功能。